# 面向造对话数据的 Wikidata 使用教程（用于生成多样化主题）

本教程面向**对话数据构造/合成（dialogue data synthesis）**场景：使用 Wikidata 作为开放知识库，通过可控采样与模板化表达，生成覆盖面广、主题多样、可追溯的中文对话数据（如闲聊、任务型、问答混合、多轮知识注入等）。

---

## 你将学到什么

完成本教程后，你将能够：

- 理解 Wikidata 的核心数据模型（Q/P、声明、限定符、引用等），并知道它如何映射到对话数据需求。
- 使用 Wikidata Query Service（WDQS）编写 SPARQL 查询，**按主题、类型、时间、地域、关系**等维度采样实体与事实。
- 设计“多样化主题生成器”：控制**主题覆盖、长尾采样、去重、难度分层、敏感内容规避**。
- 将结构化三元组/声明转成**自然中文表达**，并构造成多轮对话（提问、追问、澄清、纠错、对比、推荐等）。
- 搭建可复现的数据流水线：缓存、版本、质量评估、数据卡（data card）与合规说明。

---

## 适用读者

- 需要构造**多轮中文对话数据**的研发/产品/研究人员  
- 需要做主题覆盖、长尾采样、知识问答、多领域对话评测集的同学  
- 想用公开知识库做“可解释”的合成数据（每条数据可追溯到来源）的团队  

---

## 你需要准备什么

**最少工具（零代码也可学）**
- 浏览器（用于 WDQS：Wikidata Query Service）
- 基础数据素养（能读懂表格、字段、ID）

**推荐能力（写代码做自动化）**
- Python 基础（requests、pandas）
- 了解 JSON/CSV
- 对 SPARQL 有一点点耐心（我们会从 0 开始）

---

## 阅读路线

- **快速上手（1～2 天）**：第 1、3、4、7 章 + 附录模板  
  目标：能跑通“查询 → 采样 → 口语化 → 对话化”的最小闭环。
- **工程落地（3～7 天）**：补齐第 5、6、8、11 章  
  目标：批量生产、缓存、评估、版本化与可复现。
- **高质量中文与多语言（持续迭代）**：第 9 章 + 第 8 章深化  
  目标：更自然的中文、更强的主题多样性控制、减少事实与表达瑕疵。

---

## 核心思想（本教程的“数据观”）

对话数据的“多样化主题”不是随机堆砌，而是可控的系统工程：

1. **主题空间定义**：你要覆盖哪些领域？（人物/地点/作品/科学概念/组织/事件…）
2. **采样策略**：头部与长尾怎么平衡？如何避免全是“欧美名人+热门城市”？
3. **表达策略**：结构化事实如何变成自然中文？如何多样化问法与追问？
4. **对话结构**：单轮问答 vs 多轮澄清、对比、推荐、纠错、追问证据链
5. **质量评估**：事实一致性、重复率、主题覆盖率、语言自然度、安全与合规

Wikidata 的价值在于：**可结构化采样 + 可追溯**（每条事实都有实体 ID、属性 ID，有时还有引用来源）。

---

## 目录

> 下面是本教程计划章节（你可以按需阅读）。点击可跳转到相应文件。

### [Chapter 1：Wikidata 与对话数据：为什么它适合做“多样化主题”](chapter1.md)
- 用 Wikidata 造对话数据的典型用例
- 结构化知识对“主题覆盖/可控采样/可追溯”的意义
- 你将构建的最终数据流水线概览

### [Chapter 2：Wikidata 数据模型速通（Q/P/声明/限定符/引用）](chapter2.md)
- QID（实体）与 PID（属性）
- statement / qualifier / reference
- label/description/alias 与多语言
- 常见坑：时间、坐标、单位、多个值、冲突值

### [Chapter 3：WDQS 入门：用 SPARQL 把知识“查出来”](chapter3.md)
- WDQS 界面与结果格式
- 最小可用查询（按类型取实体）
- 过滤、排序、限制、去重
- label 服务与中文标签获取

### [Chapter 4：主题生成：从知识图谱采样“多样化主题池”](chapter4.md)
- 主题空间设计：领域→子领域→主题→实例
- 多样化策略：分层采样、长尾加权、地域/时间均衡
- 去重策略：实体去重、关系去重、问法去重
- 敏感内容的预过滤（类型、属性、关键词、黑白名单）

### [Chapter 5：把事实变成对话：多轮结构与标注方案](chapter5.md)
- 多轮对话的“动作集合”：询问/追问/澄清/对比/推荐/纠错
- 角色设定与口吻多样化（不改变事实）
- 标注字段建议：topic、entities、facts、turn_intent、difficulty、source_qid/pid

### [Chapter 6：自动化抓取与缓存：从 WDQS 到本地数据管道](chapter6.md)
- SPARQL 批量查询与分页
- 缓存、断点续跑、速率限制与失败重试
- 数据落地格式：JSONL/Parquet/SQLite
- 可复现：查询版本、时间戳、endpoint 记录

### [Chapter 7：中文自然语言生成：从三元组到口语化表达](chapter7.md)
- 中文模板库：别名/简称/时间表达/量纲单位
- 多种问法生成：同义改写、信息密度控制
- 避免“百科腔”与避免过拟合模板
- 让对话更像人：补全背景句、自然追问、上下文省略

### [Chapter 8：质量控制与评估：覆盖率、重复率、事实一致性](chapter8.md)
- 覆盖率指标（主题/类型/地域/时间）
- 重复率与近重复检测
- 事实一致性检查：同一实体多属性冲突、过期信息、缺失中文标签
- 抽检策略与自动审计（审计日志）

### [Chapter 9：多语言与中文缺失处理](chapter9.md)
- 中文 label 缺失怎么办：回退策略（英文→翻译/音译/保留）
- 中英文混排的可接受边界
- 别名与描述的选择：更口语 vs 更严谨

### [Chapter 10：许可与合规：Wikidata CC0 与对话数据发布注意事项](chapter10.md)
- Wikidata 的 CC0 含义与“可用/可发布”的边界
- 引用来源与外部链接的处理策略
- 数据集说明（data card）建议字段

### [Chapter 11：工程化实践：从脚本到生产级流水线](chapter11.md)
- 任务分解：采样器、规范化器、生成器、评估器
- 单元测试与回归：避免“改模板导致全量漂移”
- 版本管理：query 版本、模板版本、词表版本

### [Appendices：查询模板库与速查表](chapter12.md)
- 常用“按类型取实体”模板
- 常用属性（P）与类型（Q）索引思路
- 可直接复制的多样化采样查询合集
- 常见错误与排障清单

---

## 本教程的产出物（建议你跟做）

建议你在学的过程中同步产出这些文件（不强制）：

- `topic_schema.yaml`：主题空间定义（领域、子领域、采样权重、过滤规则）
- `queries/`：SPARQL 查询集合（每个查询说明用途与字段）
- `templates/`：中文问法与答法模板库
- `dataset.jsonl`：最终对话数据（每行一个对话，包含元信息与可追溯来源）
- `audit_report.md`：质量评估与抽检报告
- `DATA_CARD.md`：数据卡（许可、生成流程、风险说明、使用建议）

---

## 约定与记号

为避免阅读歧义，本教程使用以下约定：

- `Qxxxx`：实体（Item），例如某个城市、人物、作品
- `Pxxx`：属性（Property），例如“出生日期”“位于”“作者”
- “声明（statement）”：`实体 —属性→ 值` 的基本事实
- “限定符（qualifier）”：对声明补充条件（时间范围、顺序、角色等）
- “引用（reference）”：声明的来源信息（并非每条都有）
